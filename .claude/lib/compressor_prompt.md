---
title: "summarize-compressor エージェント実行プロンプト"
description: "圧縮エージェントに与える指示文"
---

# Compressor エージェント実行プロンプト

`@summarize_inputs` コマンド内で、以下のプロンプトを使用して compressor エージェントを Task として呼び出します。

---

## 基本プロンプト（テンプレート）

```markdown
# Summary 圧縮タスク

詳細版 Summary（docs/00_inputs/summary.md）を読み込み、圧縮版（docs/00_inputs/summary_compressed.md）を自動生成してください。

## タスク概要

- **入力**: docs/00_inputs/summary.md の内容
- **出力**: docs/00_inputs/summary_compressed.md として保存
- **圧縮率**: 20～30%（詳細版の）

## 実行手順

### 1. ファイル読み込み

以下のファイルを読み込んでください：
- `docs/00_inputs/summary.md`（詳細版）
- `docs/<doc_type>/definitions/template.md`（参考：ドキュメント構造確認用）

### 2. セクション抽出

詳細版から以下のセクションを抽出してください：

| セクション | キーワード | 目標行数 |
|---|---|---|
| **背景・課題** | 背景、課題、状況 | 5～8 |
| **ユーザー** | ユーザー、ステークホルダー、利用者 | 3～5 |
| **スコープ WHAT** | 対象、スコープ、含む | 3～5 |
| **スコープ WHAT NOT** | 対象外、含まない、除外 | 2～3 |
| **制約** | 制約、前提、前置き | 3～5 |
| **メリット** | メリット、効果、期待効果 | 3 |

### 3. セクション別圧縮ロジック

#### 背景・課題セクション

- 箇条書きから最大 3 ポイントを抽出
- 条件: 文字数 50～100 字、定量的データ優先
- 修飾表現（「非常に」「重要な」）を削除
- ビジネス目標を 1～2 文で別途抽出

**例**:
```
入力:
- 営業データ集計には多くの手作業が必要であり、非常に負担が大きい
- 現在、営業チーム全体で月 200 時間の手作業が発生している
- ヒューマンエラーにより、月平均 5～10 件のデータ誤りが発生している

出力:
- 営業データ集計に月 200 時間の手作業が必要
- ヒューマンエラーが月 5～10 件発生
```

#### ユーザーセクション

- ロール別に 1 行（20～30 字以下）にまとめる
- ロール順序: 決定権者 → 実行担当 → その他
- 説明的部分は削除

**例**:
```
入力:
営業部長は営業チーム全体の成果を管理し、CEO へのレポート責任を持つ。
営業チーム（営業員 15 名）はデータを毎日入力・集計する。
IT 部門はシステムの保守と技術サポートを担当する。

出力:
- **営業部長**: 営業チーム全体の成果を管理・報告
- **営業チーム**: 日々のデータ入力・集計作業
- **IT 部門**: システム保守・技術サポート
```

#### スコープ WHAT セクション

- ビジネス目標に直結するもの → 実装機能 → サポート機能の順
- 重要度上位 3～5 個を選定
- 重複・冗長性を排除

**例**:
```
入力:
- 営業データの自動集計・整形（毎日実行）
- 週次レポートの自動生成（毎週金曜）
- 営業チーム間でのデータ共有
- 顧客セグメント別の売上分析（営業判断用）
- ダッシュボード表示機能
- データエクスポート機能

出力:
- 営業データの自動集計・整形
- 週次レポートの自動生成
- 顧客セグメント別の売上分析
- 営業パイプライン可視化
```

#### スコープ WHAT NOT セクション

- 明示的な「対象外」項目を優先
- 暗黙的な除外項目（新規開発、既存システム改修等）を検出
- 2～3 個を選定

**例**:
```
入力:
対象外:
- CRM システムの改修
- 既存営業システムインフラの刷新

暗黙的（含まれないもの）:
- 営業プロセス自体の変更

出力:
- CRM システムの改修
- 営業システムインフラの刷新
- 営業プロセスの変更
```

#### 制約セクション

- 実装に関わる制約を優先（期間、リソース、技術要件）
- ビジネス制約を次点（予算、市場条件）
- 詳細な背景説明（「～なので」）を削除
- 3～5 個を選定

**例**:
```
入力:
- 予算は 500 万円以内に制限されている。これは経営層の決定に基づく。
- 実装期間は 6 ヶ月以内である。市場競争の観点から重要である。
- 既存営業システムとの連携が必須である。システム統合の大原則。
- 営業チーム（15 名）への研修実施が必要である。
- 月次報告時には稼働状態を要する。システムの信頼性が重要。

出力:
- 予算上限：500 万円
- 実装期間：6 ヶ月以内
- 既存営業システムとの連携が必須
- 営業チーム研修の実施が必要
- 月次報告時の稼働状態を要する
```

#### メリット・結果セクション

- 定量的メリット（%、数値、KPI）を優先
- 抽象的な表現は削除
- TOP 3 を厳選

**例**:
```
入力:
- 営業データ集計の手作業を削減し、営業チームの負担が軽減される
- 営業データ集計の手作業削減：月 200 時間 → 50 時間（75% 削減、50% 削減の見積も）
- 営業意思決定速度の向上：現在 3 日 → 1 日で可能（66% 短縮、40% 短縮の見積も）
- ヒューマンエラー削減：月 5～10 件 → 月 0～1 件（90% 以上削減）
- 営業チーム満足度向上により、離職率が低下する可能性

出力:
- 営業データ集計の手作業削減：50%
- 営業意思決定の速度向上：40% 短縮
- ヒューマンエラー削減：90% 以上
```

### 4. テンプレート適用

以下の構造で圧縮版を組み立ててください：

```markdown
# 圧縮サマリ

## ビジネス背景・課題（100～150 words）

- [背景ポイント1（20～40字）]
- [背景ポイント2（20～40字）]
- [背景ポイント3（20～40字）]

**ビジネス目標**: [1～2文、30～50字]

## 想定ユーザー/読者

- **[ロール1]**: [説明、20～30字]
- **[ロール2]**: [説明、20～30字]
- **[ロール3]**: [説明、20～30字]

## スコープ（WHAT/WHAT NOT）

### 対象（WHAT）

- [項目1]
- [項目2]
- [項目3]
- [項目4]
- [項目5]

### 対象外（WHAT NOT）

- [項目1]
- [項目2]
- [項目3]

## 提案/計画の要点

### ソリューション概要

[1～2文、40～60字]

### 主なメリット

- [メリット1（20～40字、定量的データ含む）]
- [メリット2（20～40字、定量的データ含む）]
- [メリット3（20～40字、定量的データ含む）]

## 制約・前提条件

- [制約1（20～40字）]
- [制約2（20～40字）]
- [制約3（20～40字）]
- [制約4（20～40字）]
- [制約5（20～40字）]

---

生成日時: [ISO 8601 形式: 2025-12-17T10:30:45Z]
圧縮率: [圧縮版文字数 ÷ 詳細版文字数 × 100]%
元ファイル: docs/00_inputs/summary.md
```

### 5. 検証

以下をチェックしてください：

- ✓ 全ての必須セクションが存在するか
- ✓ 圧縮率が 20～30% か
- ✓ 合計行数が 30～50 行か
- ✓ 合計文字数が 350～800 字か
- ✓ テンプレート構造が正しいか
- ✓ Markdown フォーマットが正しいか

検証で問題がある場合は、**警告を出力して続行**してください。

### 6. ファイル保存

Write ツールを使用して、以下のファイルに保存してください：

```
ファイルパス: docs/00_inputs/summary_compressed.md
内容: 圧縮版 Summary（テンプレート適用後）
```

### 7. 完了メッセージ

処理完了後、以下の形式でメッセージを表示してください：

```
✓ 圧縮版 Summary を生成しました

詳細版: {詳細版のトークン数推定値} tokens
圧縮版: {圧縮版のトークン数推定値} tokens
圧縮率: {compression_ratio:.1%}

対象セクション: {検出されたセクション数} 個検出
警告: {警告件数} 件
  [具体的な警告メッセージ]

ファイル保存完了: docs/00_inputs/summary_compressed.md
```

---

## 注意事項

### セクション検出の堅牢性

Markdown の見出しが多様である可能性に対応してください：

```
# キーワード辞書の例
"背景": ["背景", "背景・課題", "ビジネス背景", "状況", "背景説明"]
"ユーザー": ["ユーザー", "ステークホルダー", "想定読者", "利用者"]
"要件": ["要件", "スコープ", "機能要件", "対象", "実装内容"]
"制約": ["制約", "前提条件", "前置き", "制限事項", "留意事項"]
"メリット": ["期待効果", "メリット", "得られるもの", "ビジネスインパクト"]

セクション探索時は、これらのキーワードを全て試してください。
```

### 抽出失敗時のハンドリング

セクションが見つからない場合：

```
1. 警告を出力: "警告: [セクション名] が見つかりません"
2. プレースホルダーを使用: "[情報を入力してください]"
3. 処理を続行（エラーで中断しない）
```

### トークン数推定方法

```python
import re

def estimate_tokens(text):
    # 日本語文字数
    jp_chars = len(re.findall(r'[\u4e00-\u9fff\u3040-\u309f\u30a0-\u30ff]', text))
    jp_tokens = jp_chars / 3.5

    # 英数字単語数
    en_words = len(text.split())
    en_tokens = en_words / 1.3

    return int(jp_tokens + en_tokens)

compression_ratio = estimate_tokens(compressed) / estimate_tokens(detailed) * 100
```

### 圧縮率の判定

```
圧縮率 < 15%: ⚠️  圧縮率が低すぎます（15%未満）
圧縮率 15～30%: ✓ 目標範囲内
圧縮率 > 35%: ⚠️  圧縮率が高すぎます（35%超）

目標: 20～30%
許容範囲: 15～35%（警告対象外）
```

---

## エラーハンドリング

### 重大エラー（処理中断）

```
❌ summary.md が存在しない
   → エラーメッセージを表示して終了
```

### 軽度警告（処理続行）

```
⚠️  セクション検出失敗
   → 警告を出力、プレースホルダー使用

⚠️  圧縮率異常
   → 警告を出力、ファイルは保存

⚠️  行数・文字数異常
   → 警告を出力、ファイルは保存
```

