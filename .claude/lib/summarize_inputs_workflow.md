---
title: "@summarize_inputs コマンド実行フロー"
description: "ユーザーが @summarize_inputs を実行した時の処理順序"
---

# @summarize_inputs コマンド実行フロー

`@summarize_inputs` を実行した際の、段階的な処理フローと出力を説明します。

---

## ユーザーの実行操作

```
ユーザー: @summarize_inputs
```

---

## Stage 1: 詳細版 Summary 生成（既存処理）

### 処理内容

```
Step 1: docs/00_inputs/ の全 .md ファイルを読み込み
  ├─ ファイル一覧作成
  ├─ 各ファイル内容を読込
  └─ summary.md 自体は除外

Step 2: セクション別サマリ作成
  ├─ プロジェクト概要
  ├─ ビジネス背景/課題
  ├─ 要件・制約
  ├─ 利用者・ステークホルダー
  ├─ 業務フロー/シナリオ
  └─ その他参考情報

Step 3: Markdown でサマリ構成

Step 4: Write ツールで docs/00_inputs/summary.md に保存
```

### 出力メッセージ

```
✓ 詳細版 Summary を生成しました
  ファイルパス: docs/00_inputs/summary.md
  推定トークン数: 2,340 tokens
  対象セクション: 6 個作成

処理中...（圧縮版生成に進む）
```

**ユーザーの体感**: 1～2 分で詳細版が生成される

---

## Stage 2: 圧縮版 Summary 生成（新規処理）

### Stage 1 完了直後に自動実行

```
Task: summarize-compressor エージェント呼び出し

入力:
  - summary_path: docs/00_inputs/summary.md
  - 圧縮プロンプト: compressor_prompt.md の内容

処理:
  1. summary.md を読み込む
  2. セクション抽出・圧縮ロジック実行
  3. テンプレート適用
  4. 検証実行
  5. docs/00_inputs/summary_compressed.md に保存
```

### 圧縮エージェント内の処理フロー

```
compressor エージェント開始
  ↓
[1] ファイル読み込み
  ├─ docs/00_inputs/summary.md を読込
  └─ 全文をメモリに保持
  ↓
[2] セクション抽出
  ├─ "背景" キーワード検索 → セクション抽出
  ├─ "ユーザー" キーワード検索 → セクション抽出
  ├─ "要件" キーワード検索 → セクション抽出
  ├─ "制約" キーワード検索 → セクション抽出
  └─ "メリット" キーワード検索 → セクション抽出
  ↓
[3] セクション別圧縮
  ├─ 背景・課題: 3 ポイント + ビジネス目標
  ├─ ユーザー: ロール別 3～5 個
  ├─ スコープ WHAT: 3～5 個
  ├─ スコープ WHAT NOT: 2～3 個
  ├─ 制約: 3～5 個
  └─ メリット: TOP 3
  ↓
[4] テンプレート適用
  ├─ 圧縮版テンプレートに埋め込み
  ├─ メタ情報追加（生成日時、圧縮率）
  └─ Markdown 正規化
  ↓
[5] 検証
  ├─ セクション数チェック
  ├─ 圧縮率計算 (20～30% か確認)
  ├─ 行数チェック (30～50 行か)
  ├─ 文字数チェック (350～800 字か)
  └─ フォーマット確認
  ↓
[6] ファイル保存
  ├─ Write ツール使用
  └─ docs/00_inputs/summary_compressed.md に保存
  ↓
[7] 完了メッセージ出力
  └─ 圧縮率、トークン数などを表示
```

### 出力メッセージ

```
✓ 圧縮版 Summary を生成しました
  ファイルパス: docs/00_inputs/summary_compressed.md

  詳細版: 2,340 tokens
  圧縮版: 586 tokens
  圧縮率: 25.0%

  対象セクション: 6 個検出
  警告: 0 件
```

**ユーザーの体感**: 圧縮版は 30 秒～1 分で生成

---

## 全体プロセス（ユーザー視点）

```
ユーザー: @summarize_inputs を実行

  ↓ [1～2 分]

ターミナル表示:
┌─────────────────────────────────────┐
│ ✓ 詳細版 Summary を生成しました      │
│   docs/00_inputs/summary.md        │
│   2,340 tokens                     │
│                                   │
│ 処理中...                           │
│                                   │
│ ✓ 圧縮版 Summary を生成しました      │
│   docs/00_inputs/summary_compressed.md │
│   586 tokens → 圧縮率 25.0%        │
│                                   │
│ 完了✓                              │
└─────────────────────────────────────┘

  ↓ [処理完了]

ユーザーは以下のファイルを得る:
  1. docs/00_inputs/summary.md（詳細版）
  2. docs/00_inputs/summary_compressed.md（圧縮版）
```

---

## ファイル出力例

### 詳細版ファイル（summary.md）

```markdown
# 要約

## プロジェクト概要

[500+ words...]

## ビジネス背景

[800+ words...]

## ユーザー・ステークホルダー

[300+ words...]

## 要件

[600+ words...]

## 制約・前提

[200+ words...]

## 期待効果

[100+ words...]
```

**行数**: ~100 行
**トークン**: ~2,340 tokens

### 圧縮版ファイル（summary_compressed.md）

```markdown
# 圧縮サマリ

## ビジネス背景・課題

- AI の活用により営業効率 30% 向上を目指す
- 営業データの自動集計に 50% の手作業が発生
- 目標: 6 ヶ月以内に AI 導入・効果実証完了

**ビジネス目標**: AI を活用してデータ集計の手作業を削減し、営業意思決定を高速化する。

## 想定ユーザー/読者

- **営業部長**: 営業チーム全体の成果を管理・報告
- **営業チーム**: 日々のデータ入力・集計作業
- **IT 部門**: システム保守・技術サポート

## スコープ（WHAT/WHAT NOT）

### 対象（WHAT）

- 営業データの自動集計・整形
- 週次レポートの自動生成
- 顧客セグメント別の売上分析
- 営業パイプライン可視化

### 対象外（WHAT NOT）

- CRM システムの改修
- 営業プロセスの変更
- 既存営業システムのインフラ刷新

## 提案/計画の要点

### ソリューション概要

AI を活用した営業支援システムを導入し、営業データの自動集計とリアルタイム分析を実現します。

### 主なメリット

- 営業データ集計の手作業削減：50%
- 営業意思決定の速度向上：40% 短縮
- ヒューマンエラー削減：90% 以上

## 制約・前提条件

- 予算上限：500 万円
- 実装期間：6 ヶ月以内
- 既存営業システムとの連携が必須
- 営業チーム（15 名）への研修実施が必要
- 月次報告時には稼働状態を要する

---

生成日時: 2025-12-17T10:30:45Z
圧縮率: 25.0%
元ファイル: docs/00_inputs/summary.md
```

**行数**: ~45 行
**トークン**: ~586 tokens

---

## エラーが出た場合の対応

### エラー 1: summary.md が見つからない

```
❌ エラー: docs/00_inputs/summary.md が見つかりません

対応:
  1. @summarize_inputs を再実行して詳細版を生成
  2. 手動で docs/00_inputs/ に summary.md を配置
```

### エラー 2: セクション検出失敗

```
⚠️  警告: ビジネス背景セクションが見つかりません

対応:
  1. summary.md の見出しを確認
  2. 見出しが ## ビジネス背景 等になっているか確認
  3. 必要に応じて見出しを修正して再実行
```

### エラー 3: 圧縮率異常

```
⚠️  警告: 圧縮率が高すぎます（45%）
       目標: 20～30%

対応:
  1. 手動で docs/00_inputs/summary_compressed.md を確認
  2. セクションの内容が十分に圧縮されているか確認
  3. 不要な詳細説明を削除
```

---

## チェックリスト（実行後の確認）

```
実行後にこちらを確認:

 [ ] docs/00_inputs/summary.md が生成されたか
 [ ] docs/00_inputs/summary_compressed.md が生成されたか
 [ ] 圧縮版のサイズが詳細版の 20～30% か
 [ ] 圧縮版の全セクションが揃っているか
 [ ] メタ情報（生成日時、圧縮率）が記載されているか
 [ ] /create_document で圧縮版が参照されるか動作確認
```

---

## 次のステップ

圧縮版が生成されたら：

1. `/create_document` を実行（圧縮版が自動参照される）
2. ドキュメント生成時のコンテキスト削減を確認
3. evaluator/finalizer が圧縮版を正常に処理するか確認

