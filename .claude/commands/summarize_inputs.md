---
description: "入力情報を要約して summary.md を生成"
---

# 入力要約コマンド

`docs/00_inputs/` 配下の全 `.md` ファイルを要約し、以下 2 つのファイルを生成：

1. **`docs/00_inputs/summary.md`** （詳細版・ドラフター用）
2. **`docs/00_inputs/summary_compressed.md`** （圧縮版・評価/統合エージェント用）

## 実行手順

### ステップ 1: 詳細版 Summary 生成

1. `docs/00_inputs/**/*.md` を読み込み（既存の summary*.md は除外）
2. 以下の構造で要約を作成:
   - プロジェクト概要
   - ビジネス背景/課題
   - 要件・制約
   - 利用者・ステークホルダー
   - 業務フロー/シナリオ
   - その他の参考情報
3. **Write ツール**で `docs/00_inputs/summary.md` に保存

### ステップ 2: 圧縮版 Summary 生成（**新規追加**）

1. 生成した詳細版 summary.md を入力として受け取る
2. 以下のルールで **20～30%** に圧縮:
   - 背景説明 → 要点のみ 100～150 words（最大 3 ポイント）
   - インタビュー内容 → 実装・投資に関する制約のみ抽出
   - 要件リスト → スコープの WHAT/WHAT NOT に集約
   - 想定結果 → メリット最大 3 点を厳選
3. **Write ツール**で `docs/00_inputs/summary_compressed.md` に保存

## 詳細版 Summary の粒度

- **目標**: 2,000〜4,000 トークン程度
- **用途**: ドラフター（doc-drafter）への入力
- **要件**: ドラフターがこの要約のみで仕様書等を書けるレベル
- **品質**: 重複は統合、詳細な議事録は結論のみ抽出

## 圧縮版 Summary の粒度

- **目標**: 400～600 トークン程度（詳細版の 20～30%）
- **用途**: 評価エージェント（doc-evaluator）、統合エージェント（doc-finalizer）への入力
- **要件**: ドラフト内容の合格判定に必要な最小限の背景情報のみ
- **品質**: キーワードのみ、修飾表現は削除

---

## 実装フロー

### Step 1: 入力ファイルの確認

1. `docs/00_inputs/summary.md` が存在するか確認
2. なければエラーメッセージを表示して終了

### Step 2: 詳細版 Summary の分析・抽出

詳細版ファイルから以下のセクションを抽出：

- **背景・課題セクション**: 市場背景、現状課題、ビジネス目標
- **ユーザーセクション**: 想定ユーザー・ステークホルダー
- **要件セクション**: 機能要件、非機能要件
- **制約・前提条件セクション**: 実装・投資に関わる制約
- **結果・メリットセクション**: 期待効果・メリット

### Step 3: 圧縮ロジック実行

以下のルールで各セクションを圧縮：

| セクション | 抽出ルール | 結果行数 |
|---|---|---|
| **背景・課題** | 要点 3 ポイント + ビジネス目標 | 5～8行 |
| **ユーザー** | ロール別 1 行ずつ | 3～5行 |
| **スコープ（WHAT）** | 対象項目 3～5 個 | 3～5行 |
| **スコープ（WHAT NOT）** | 除外項目 2～3 個 | 2～3行 |
| **制約** | 実装/投資に関わる制約のみ | 3～5行 |
| **メリット** | トップ 3 のみ | 3行 |

### Step 4: テンプレート適用

以下の構造で圧縮版を組み立て：

```markdown
# 圧縮サマリ

## ビジネス背景・課題（100～150 words）
[背景・課題の要点]

## 想定ユーザー/読者
[ユーザーロール]

## スコープ（WHAT/WHAT NOT）
- 対象: [3～5項目]
- 対象外: [2～3項目]

## 提案/計画の要点
- ソリューション: [1～2文]
- メリット: [3項目]

## 制約・前提条件
[3～5項目]
```

### Step 5: ファイル保存

1. **Write ツール** で `docs/00_inputs/summary_compressed.md` に保存
2. 完了メッセージを表示

---

## 圧縮ロジックの詳細

### 背景・課題セクション

**抽出方法**:
1. "背景" / "課題" / "目標" セクションを探す
2. 各セクションから箇条書きを抽出
3. 文字数 50～100 字のポイントを最大 3 個選定
4. ビジネス目標は 1～2 文で簡潔に

**削除するもの**:
- 歴史的背景、詳細な市場調査
- 修飾表現（「非常に」「重要な」など）

### ユーザーセクション

**抽出方法**:
1. "利用者" / "ステークホルダー" / "想定読者" セクション探索
2. ロール（決定権者、実行担当、その他）ごとに 1 行にまとめる
3. 説明は 20～30 字以下

### スコープセクション

**抽出方法（WHAT）**:
1. "対象" / "スコープ" セクション探索
2. 機能・対象外を分離
3. 重要度上位 3～5 個を選定

**抽出方法（WHAT NOT）**:
1. "対象外" / "除外" セクション探索
2. 実装を避けるべき項目を 2～3 個選定

### 制約・前提条件セクション

**抽出方法**:
1. "制約" / "前提" / "前置き" セクション探索
2. **実装に関わる制約**（期間、リソース、技術要件）を優先
3. **ビジネス制約**（予算、市場条件）を次点
4. 詳細な背景は削除

### メリット・結果セクション

**抽出方法**:
1. "期待効果" / "メリット" / "結果" セクション探索
2. **定量的メリット**（数値、KPI）を優先
3. トップ 3 を厳選
4. 説明は 30～50 字以下

---

## 出力例

### 詳細版（2,500 tokens）

```markdown
# 要約（詳細版）

## プロジェクト概要
[500 words...]

## ビジネス背景
[800 words...]

## ユーザー・ステークホルダー
[300 words...]

## 要件
[600 words...]

## 制約・前提
[200 words...]

## 期待効果
[100 words...]
```

### 圧縮版（500 tokens）

```markdown
# 圧縮サマリ

## ビジネス背景・課題
- AI の活用により営業効率 30% 向上を目指す
- 営業データの自動集計に 50% の手作業が発生
- 目標: 6 ヶ月以内に AI 導入・効果実証完了

## 想定ユーザー/読者
- 営業部長（意思決定者）
- 営業チーム（利用者）
- IT 部門（サポート担当）

## スコープ
- 対象: 営業データ集計、レポート自動生成、顧客別分析
- 対象外: CRM システム改修、既存業務フロー変更

## 提案の要点
- AI を活用した営業支援システムの導入
- メリット: 手作業削減 50%、意思決定速度 40% 向上、離職率低下

## 制約
- 予算: 500 万円以内
- 期間: 6 ヶ月
- 既存システムとの連携が必須
```

---

## 実装フロー（最終版）

```
@summarize_inputs 実行
  ↓
Step 1: 入力ファイル確認（docs/00_inputs/ の .md ファイル）
  ↓
Step 2-3: 詳細版 Summary 生成
  ├─ 各セクション作成
  └─ docs/00_inputs/summary.md に保存
  ↓
✓ 詳細版完了メッセージ表示
  ↓
Step 4-7: 圧縮版 Summary 生成（新規プロセス）
  ├─ Task: summarize-compressor エージェント呼び出し
  ├─ 入力: docs/00_inputs/summary.md
  ├─ 処理: セクション抽出・圧縮ロジック・テンプレート適用・検証
  └─ 出力: docs/00_inputs/summary_compressed.md に保存
  ↓
✓ 圧縮版完了メッセージ表示（トークン数・圧縮率含む）
  ↓
完了
```

### 詳細版→圧縮版への Task 呼び出し

**タイミング**: 詳細版が正常に保存された直後

**呼び出し方法**:

```
Task: summarize-compressor エージェント

入力プロンプト:
【ここに compressor_prompt.md の内容を埋め込む】

実行条件:
  - summary.md が docs/00_inputs/ に存在すること
  - 並列実行不要（詳細版完了後に順序立てて実行）

出力の処理:
  - 完了メッセージを表示
  - エラーの場合は その旨を表示
```

---

## 注意事項

1. **詳細版の存在確認**: summary.md がなければ警告を表示
2. **上書き確認**: summary_compressed.md が既に存在する場合、上書きする旨を明記
3. **圧縮率チェック**: 生成後、圧縮率を表示（目標 20～30%）
4. **フォーマット検証**: テンプレート構造が正しいか確認
5. **エラーハンドリング**: 圧縮処理に失敗しても詳細版は保持（重大エラーのみ中断）
